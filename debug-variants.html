<!DOCTYPE html>
<html>
<head>
    <title>Debug Lemonsqueezy Variants</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” Lemonsqueezy Variants Debug Tool</h1>
    
    <div>
        <h3>é…ç½®ä¿¡æ¯</h3>
        <div>API Key: <input type="text" id="apiKey" placeholder="è¾“å…¥ä½ çš„ API Key" style="width: 400px;"></div>
        <div>Store ID: <input type="text" id="storeId" placeholder="è¾“å…¥ä½ çš„ Store ID" value="76046"></div>
    </div>

    <div>
        <h3>æµ‹è¯•å˜ä½“ ID</h3>
        <button onclick="testVariant('999961', 'Basic Plan')">æµ‹è¯• Basic (999961)</button>
        <button onclick="testVariant('999967', 'Pro Plan')">æµ‹è¯• Pro (999967)</button>
        <button onclick="testVariant('999981', 'Premium Plan')">æµ‹è¯• Premium (999981)</button>
        <button onclick="testAllVariants()">æµ‹è¯•æ‰€æœ‰å˜ä½“</button>
    </div>

    <div>
        <h3>å…¶ä»–æµ‹è¯•</h3>
        <button onclick="testApiKey()">æµ‹è¯• API Key</button>
        <button onclick="listStores()">è·å–åº—é“ºåˆ—è¡¨</button>
        <button onclick="listProducts()">è·å–äº§å“åˆ—è¡¨</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <div id="results"></div>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function getApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                addResult('âŒ è¯·å…ˆè¾“å…¥ API Key', 'error');
                return null;
            }
            return apiKey;
        }

        async function testVariant(variantId, planName) {
            const apiKey = getApiKey();
            if (!apiKey) return;

            addResult(`ğŸ” æµ‹è¯• ${planName} å˜ä½“ ID: ${variantId}`, 'info');
            
            try {
                const response = await fetch(`https://api.lemonsqueezy.com/v1/variants/${variantId}`, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Accept': 'application/vnd.api+json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    addResult(`âœ… ${planName} å˜ä½“å­˜åœ¨ï¼<br>
                        <strong>åç§°:</strong> ${data.data.attributes.name}<br>
                        <strong>ä»·æ ¼:</strong> $${(data.data.attributes.price / 100).toFixed(2)}<br>
                        <strong>çŠ¶æ€:</strong> ${data.data.attributes.status}<br>
                        <strong>äº§å“ ID:</strong> ${data.data.relationships.product.data.id}`, 'success');
                } else {
                    addResult(`âŒ ${planName} å˜ä½“ä¸å­˜åœ¨ (${response.status})<br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult(`âŒ ${planName} è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testAllVariants() {
            await testVariant('999961', 'Basic Plan');
            await testVariant('999967', 'Pro Plan');
            await testVariant('999981', 'Premium Plan');
        }

        async function testApiKey() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            addResult('ğŸ” æµ‹è¯• API Key æœ‰æ•ˆæ€§...', 'info');
            
            try {
                const response = await fetch('https://api.lemonsqueezy.com/v1/users/me', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Accept': 'application/vnd.api+json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    addResult(`âœ… API Key æœ‰æ•ˆï¼<br>
                        <strong>ç”¨æˆ·:</strong> ${data.data.attributes.name}<br>
                        <strong>é‚®ç®±:</strong> ${data.data.attributes.email}`, 'success');
                } else {
                    addResult(`âŒ API Key æ— æ•ˆ (${response.status})<br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult(`âŒ API Key æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function listStores() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            addResult('ğŸ” è·å–åº—é“ºåˆ—è¡¨...', 'info');
            
            try {
                const response = await fetch('https://api.lemonsqueezy.com/v1/stores', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Accept': 'application/vnd.api+json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    const stores = data.data.map(store => 
                        `<li><strong>${store.attributes.name}</strong> (ID: ${store.id}) - ${store.attributes.domain}</li>`
                    ).join('');
                    addResult(`âœ… æ‰¾åˆ° ${data.data.length} ä¸ªåº—é“º:<br><ul>${stores}</ul>`, 'success');
                } else {
                    addResult(`âŒ è·å–åº—é“ºå¤±è´¥ (${response.status})<br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult(`âŒ è·å–åº—é“ºå¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function listProducts() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            const storeId = document.getElementById('storeId').value.trim();
            if (!storeId) {
                addResult('âŒ è¯·è¾“å…¥ Store ID', 'error');
                return;
            }

            addResult(`ğŸ” è·å–åº—é“º ${storeId} çš„äº§å“åˆ—è¡¨...`, 'info');
            
            try {
                const response = await fetch(`https://api.lemonsqueezy.com/v1/products?filter[store_id]=${storeId}`, {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Accept': 'application/vnd.api+json'
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    if (data.data.length === 0) {
                        addResult('âš ï¸ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•äº§å“', 'error');
                        return;
                    }

                    let productsHtml = '';
                    for (const product of data.data) {
                        productsHtml += `<li><strong>${product.attributes.name}</strong> (ID: ${product.id})<br>`;
                        productsHtml += `çŠ¶æ€: ${product.attributes.status}, ä»·æ ¼: $${(product.attributes.price / 100).toFixed(2)}<br>`;
                        
                        // è·å–å˜ä½“ä¿¡æ¯
                        try {
                            const variantsResponse = await fetch(`https://api.lemonsqueezy.com/v1/variants?filter[product_id]=${product.id}`, {
                                headers: {
                                    'Authorization': `Bearer ${apiKey}`,
                                    'Accept': 'application/vnd.api+json'
                                }
                            });
                            const variantsData = await variantsResponse.json();
                            if (variantsResponse.ok && variantsData.data.length > 0) {
                                productsHtml += 'å˜ä½“: ';
                                variantsData.data.forEach(variant => {
                                    productsHtml += `<code>${variant.id}</code> (${variant.attributes.name}) `;
                                });
                            }
                        } catch (e) {
                            productsHtml += 'å˜ä½“ä¿¡æ¯è·å–å¤±è´¥';
                        }
                        productsHtml += '</li><br>';
                    }
                    
                    addResult(`âœ… æ‰¾åˆ° ${data.data.length} ä¸ªäº§å“:<br><ul>${productsHtml}</ul>`, 'success');
                } else {
                    addResult(`âŒ è·å–äº§å“å¤±è´¥ (${response.status})<br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                addResult(`âŒ è·å–äº§å“å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.onload = function() {
            addResult('ğŸ‘‹ æ¬¢è¿ä½¿ç”¨ Lemonsqueezy è°ƒè¯•å·¥å…·ï¼<br>è¯·å…ˆè¾“å…¥ä½ çš„ API Keyï¼Œç„¶åç‚¹å‡»ç›¸åº”æŒ‰é’®è¿›è¡Œæµ‹è¯•ã€‚', 'info');
        };
    </script>
</body>
</html>