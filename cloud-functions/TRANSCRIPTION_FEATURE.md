# éŸ³é¢‘è½¬æ–‡å­—åŠŸèƒ½ - Audio Transcription Feature

## ğŸ¯ æ›´æ–°è¯´æ˜

åº”ç”¨æˆ·è¦æ±‚ï¼Œå·²å°†**ä¸å‡†ç¡®çš„ç»“æ„åˆ†æåŠŸèƒ½**æ›¿æ¢ä¸º**éŸ³é¢‘è½¬æ–‡å­—ï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰åŠŸèƒ½**ã€‚

---

## âœ… å®Œæˆçš„æ”¹åŠ¨

### 1. åç«¯æ›´æ–° (Cloud Functions)

#### ç§»é™¤åŠŸèƒ½
- âŒ åˆ é™¤ `generateStructure()` æ–¹æ³•ï¼ˆå·²æ ‡è®°ä¸º @deprecatedï¼‰
- âŒ åˆ é™¤ç»“æ„åˆ†æç›¸å…³æç¤ºè¯ `getStructurePrompt()`
- âŒ ä»ä¸»åˆ†æ JSON schema ä¸­ç§»é™¤ `structure` å­—æ®µ
- âŒ ä» `index.ts` ä¸­ç§»é™¤ç»“æ„åˆ†æè°ƒç”¨é€»è¾‘

#### æ–°å¢åŠŸèƒ½
- âœ… æ–°å¢ `generateTranscription()` æ–¹æ³• (`vertexAIService.ts`)
- âœ… ä½¿ç”¨ Vertex AI Gemini æ¨¡å‹è¿›è¡Œè¯­éŸ³è¯†åˆ«
- âœ… æ”¯æŒå¤šç§éŸ³é¢‘å†…å®¹ç±»å‹ï¼š
  - ğŸ¤ è¯­éŸ³å¯¹è¯
  - ğŸµ æ­Œè¯è¯†åˆ«
  - ğŸ“» æ’­å®¢/å¹¿æ’­
  - ğŸ™ï¸ æ—ç™½/è§£è¯´

**è½¬å½•åŠŸèƒ½ç‰¹ç‚¹ï¼š**
```typescript
async generateTranscription(
    fileName: string,
    requestId: string,
    audioBuffer?: Buffer,
    audioMimeType?: string,
    userId?: string,
    audioFileUri?: string
): Promise<{ transcription: string; success: boolean }>
```

- ä½¿ç”¨ GCS URI ç›´æ¥åˆ†æï¼ˆæ— éœ€ä¸‹è½½å¤§æ–‡ä»¶ï¼‰
- ä½æ¸©åº¦è®¾ç½® (temperature: 0.2) æé«˜å‡†ç¡®æ€§
- æ”¯æŒå¤šè¯´è¯äººæ ‡æ³¨
- è‡ªåŠ¨è¯†åˆ«æ— è¯­éŸ³éŸ³é¢‘
- æœ€å¤§è¾“å‡º 4096 tokensï¼ˆæ”¯æŒé•¿æ–‡æœ¬ï¼‰

### 2. å‰ç«¯æ›´æ–° (React/Astro)

#### UI æ”¹åŠ¨
- âŒ ç§»é™¤ "Structure" æ ‡ç­¾é¡µ
- âœ… æ–°å¢ "Transcription" æ ‡ç­¾é¡µ

#### è½¬å½•é¡µé¢åŠŸèƒ½
- ğŸ“ æ˜¾ç¤ºå®Œæ•´è½¬å½•æ–‡æœ¬
- â„¹ï¸ AI ç”Ÿæˆæç¤ºï¼ˆæé†’å¯èƒ½å­˜åœ¨é”™è¯¯ï¼‰
- ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ï¼š
  - å­—ç¬¦æ•°
  - è¯æ•°ï¼ˆä¼°ç®—ï¼‰
  - è¡Œæ•°
- ğŸ“‹ ä¸€é”®å¤åˆ¶è½¬å½•æ–‡æœ¬
- ğŸ¤ æ— è¯­éŸ³å‹å¥½æç¤º

### 3. ç±»å‹å®šä¹‰æ›´æ–°

**AnalysisResult æ¥å£æ›´æ–°ï¼š**
```typescript
export interface AnalysisResult {
    // ... å…¶ä»–å­—æ®µ ...
    transcription: string;  // æ–°å¢ï¼šéŸ³é¢‘è½¬æ–‡å­—å†…å®¹
    // structure: StructuralAnalysis;  // ç§»é™¤
}
```

---

## ğŸ“ è½¬å½•æç¤ºè¯è®¾è®¡

```
Please listen to this audio file and transcribe ALL spoken words, dialogue, or narration you hear.

Instructions:
1. Transcribe EVERYTHING you hear people saying
2. If multiple speakers, indicate speaker changes with "Speaker 1:", "Speaker 2:", etc.
3. Include all dialogue, narration, speech content
4. If there's background music with lyrics, transcribe the lyrics
5. If there's NO speech/singing, respond with: "No speech detected - ..."
6. Preserve natural flow and punctuation
7. Note any unclear or inaudible parts with [inaudible]

Output format:
- Just the transcription text, nothing else
- No JSON, no markdown formatting
- Natural readable text with proper punctuation
- Indicate speaker changes if multiple speakers
```

---

## ğŸ¨ å‰ç«¯æ˜¾ç¤º

### æœ‰è½¬å½•å†…å®¹æ—¶ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Audio Transcription                        â”‚
â”‚ Extracted text from speech, dialogue, or lyricsâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸ AI-Generated Transcription                 â”‚
â”‚ May contain errors for unclear audio...       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [è½¬å½•æ–‡æœ¬å†…å®¹]                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Characters: 1,234                          â”‚
â”‚ ğŸ“Š Words: 234                                 â”‚
â”‚ ğŸ“Š Lines: 15                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“‹ Copy Transcription]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ— è¯­éŸ³æ—¶ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ğŸ¤                                      â”‚
â”‚    No Speech Detected                          â”‚
â”‚ This audio contains only [content type]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ åˆ†ææµç¨‹

```
1. ä¸»åˆ†æ (analyzeAudio)
   â”œâ”€ contentType
   â”œâ”€ basicInfo (genre, mood, BPM, etc.)
   â”œâ”€ emotions
   â”œâ”€ voiceAnalysis
   â”œâ”€ soundEffects
   â”œâ”€ quality
   â”œâ”€ similarity
   â””â”€ tags

2. å•ç‹¬ç”Ÿæˆæè¿° (generateDescription)
   â””â”€ aiDescription âœ…

3. å•ç‹¬ç”Ÿæˆè½¬å½• (generateTranscription) ğŸ†•
   â””â”€ transcription âœ…
```

---

## ğŸ¯ æ”¯æŒçš„å†…å®¹ç±»å‹

| å†…å®¹ç±»å‹ | è½¬å½•æ•ˆæœ | è¯´æ˜ |
|---------|---------|------|
| ğŸ¤ **è¯­éŸ³/å¯¹è¯** | âœ… ä¼˜ç§€ | å¯è¯†åˆ«å¤šè¯´è¯äººã€æ ‡è®°è¯´è¯äººå˜åŒ– |
| ğŸµ **éŸ³ä¹+æ­Œè¯** | âœ… è‰¯å¥½ | å¯è¯†åˆ«æ­Œè¯æ–‡æœ¬ |
| ğŸ“» **æ’­å®¢/å¹¿æ’­** | âœ… ä¼˜ç§€ | å¯è½¬å½•æ•´æ®µå†…å®¹ |
| ğŸ™ï¸ **æ—ç™½/è§£è¯´** | âœ… ä¼˜ç§€ | æ¸…æ™°åº¦é«˜ï¼Œè¯†åˆ«å‡†ç¡® |
| ğŸ¹ **çº¯éŸ³ä¹** | âš ï¸ æ— è¯­éŸ³ | è¿”å› "No speech detected" |
| ğŸŒ³ **ç¯å¢ƒéŸ³** | âš ï¸ æ— è¯­éŸ³ | è¿”å› "No speech detected" |

---

## ğŸ“Š å¯¹æ¯”ï¼šç»“æ„åˆ†æ vs è½¬å½•åŠŸèƒ½

| åŠŸèƒ½ | ç»“æ„åˆ†æ (æ—§) | è½¬å½•åŠŸèƒ½ (æ–°) |
|-----|-------------|-------------|
| **å‡†ç¡®åº¦** | âš ï¸ ä¸å‡†ç¡® | âœ… è¾ƒå‡†ç¡® |
| **ç”¨æˆ·ä»·å€¼** | ğŸ¤” æœ‰é™ | âœ… å®ç”¨æ€§å¼º |
| **é€‚ç”¨åœºæ™¯** | ğŸµ ä»…éŸ³ä¹ | ğŸ¤ğŸµğŸ“» å¹¿æ³› |
| **æŠ€æœ¯éš¾åº¦** | é«˜ï¼ˆæ—¶é—´æˆ³è¯†åˆ«å›°éš¾ï¼‰ | ä¸­ï¼ˆæ–‡æœ¬è¯†åˆ«è¾ƒæˆç†Ÿï¼‰ |
| **ç”¨æˆ·åé¦ˆ** | âŒ "ä¸€ç›´ç»™çš„ä¸å‡†" | âœ… å¾…æµ‹è¯• |

---

## ğŸš€ å·²éƒ¨ç½²çš„æ–‡ä»¶

### äº‘å‡½æ•° (Backend)
- âœ… `cloud-functions/src/index.ts` - è°ƒç”¨è½¬å½•åŠŸèƒ½
- âœ… `cloud-functions/src/services/vertexAIService.ts` - å®ç°è½¬å½•æ–¹æ³•
- âœ… `cloud-functions/src/types/analysis.ts` - æ›´æ–°ç±»å‹å®šä¹‰
- âœ… `cloud-functions/src/utils/prompts.ts` - ç§»é™¤ç»“æ„æç¤ºè¯

### å‰ç«¯ (Frontend)
- âœ… `src/components/analyze/DashboardSection.tsx` - è½¬å½•æ ‡ç­¾é¡µUI
- âš ï¸ **å‰ç«¯éœ€è¦é‡æ–°æ„å»ºéƒ¨ç½²**

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•ç”¨ä¾‹

1. **è¯­éŸ³å†…å®¹**
   - ä¸Šä¼ ä¸€æ®µæ¸…æ™°çš„è¯­éŸ³å¯¹è¯
   - éªŒè¯è½¬å½•æ–‡æœ¬å‡†ç¡®æ€§
   - æ£€æŸ¥å¤šè¯´è¯äººæ ‡æ³¨

2. **éŸ³ä¹+æ­Œè¯**
   - ä¸Šä¼ ä¸€é¦–æœ‰æ­Œè¯çš„æ­Œæ›²
   - éªŒè¯æ­Œè¯è¯†åˆ«æ•ˆæœ

3. **çº¯éŸ³ä¹**
   - ä¸Šä¼ çº¯éŸ³ä¹ï¼ˆæ— æ­Œè¯ï¼‰
   - éªŒè¯æ˜¾ç¤º "No speech detected"

4. **æ’­å®¢/è®²åº§**
   - ä¸Šä¼ è¾ƒé•¿çš„æ’­å®¢éŸ³é¢‘
   - éªŒè¯é•¿æ–‡æœ¬å¤„ç†

5. **å˜ˆæ‚ç¯å¢ƒ**
   - ä¸Šä¼ èƒŒæ™¯å™ªéŸ³è¾ƒå¤§çš„éŸ³é¢‘
   - éªŒè¯å¯¹ä¸æ¸…æ™°éŸ³é¢‘çš„å¤„ç†

### é¢„æœŸç»“æœ
- âœ… æ¸…æ™°è¯­éŸ³ï¼šå®Œæ•´å‡†ç¡®çš„è½¬å½•
- âœ… å¤šè¯´è¯äººï¼šæ ‡æ³¨ "Speaker 1:", "Speaker 2:"
- âœ… æ­Œè¯ï¼šè¯†åˆ«å‡ºæ­Œè¯æ–‡æœ¬
- âœ… çº¯éŸ³ä¹ï¼šæ˜¾ç¤º "No speech detected"
- âœ… ä¸æ¸…æ™°ï¼šæ ‡æ³¨ [inaudible]

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **AI é™åˆ¶**
   - è½¬å½•ç”± AI ç”Ÿæˆï¼Œå¯èƒ½åŒ…å«é”™è¯¯
   - å¯¹å£éŸ³ã€èƒŒæ™¯å™ªéŸ³æ•æ„Ÿ
   - ä¸æ”¯æŒæ‰€æœ‰è¯­è¨€ï¼ˆä¸»è¦æ”¯æŒè‹±è¯­ã€ä¸­æ–‡ç­‰ä¸»æµè¯­è¨€ï¼‰

2. **æ€§èƒ½è€ƒè™‘**
   - è½¬å½•æ˜¯å•ç‹¬çš„ API è°ƒç”¨
   - å¢åŠ åˆ†ææ—¶é—´ï¼ˆçº¦ +2-5 ç§’ï¼‰
   - ä½¿ç”¨ GCS URI é¿å…å¤§æ–‡ä»¶ä¼ è¾“

3. **æˆæœ¬å½±å“**
   - æ¯æ¬¡åˆ†æå¢åŠ  1 æ¬¡ Vertex AI è°ƒç”¨
   - ä¼°ç®—é¢å¤–æˆæœ¬ï¼š~$0.001-0.003 per analysis

4. **å‰ç«¯éƒ¨ç½²**
   - **é‡è¦ï¼š** å‰ç«¯ä»£ç å·²æ›´æ–°ï¼Œéœ€è¦é‡æ–°æ„å»ºéƒ¨ç½²ï¼
   - è¿è¡Œ `npm run build && npm run deploy` (Astro/Vercel)

---

## ğŸ”„ å¦‚æœéœ€è¦å›æ»š

å¦‚æœè½¬å½•åŠŸèƒ½ä¸ç†æƒ³ï¼Œå¯ä»¥ä» Git å†å²æ¢å¤ç»“æ„åˆ†æåŠŸèƒ½ï¼š

```bash
# æŸ¥çœ‹å†å²
git log --oneline -10

# å›æ»šåˆ°ç§»é™¤ç»“æ„åˆ†æä¹‹å‰
git revert <commit-hash>

# æˆ–è€…ä»å†å²æ¢å¤ç‰¹å®šæ–‡ä»¶
git checkout <commit-hash> -- cloud-functions/src/utils/prompts.ts
git checkout <commit-hash> -- cloud-functions/src/services/vertexAIService.ts
```

---

## âœ… æ€»ç»“

| é¡¹ç›® | çŠ¶æ€ |
|-----|------|
| âœ… ç§»é™¤ç»“æ„åˆ†æ | å®Œæˆ |
| âœ… æ·»åŠ è½¬å½•åŠŸèƒ½ | å®Œæˆ |
| âœ… åç«¯éƒ¨ç½² | å®Œæˆ |
| âš ï¸ å‰ç«¯éƒ¨ç½² | **éœ€è¦éƒ¨ç½²** |
| ğŸ§ª åŠŸèƒ½æµ‹è¯• | å¾…æµ‹è¯• |

**ä¸‹ä¸€æ­¥ï¼š** ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶æµ‹è¯•è½¬å½•åŠŸèƒ½ï¼ğŸ¤

