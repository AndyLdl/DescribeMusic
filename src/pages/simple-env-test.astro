---
// æœ€ç®€å•çš„ç¯å¢ƒå˜é‡æµ‹è¯•
const apiKey = import.meta.env.VITE_LEMONSQUEEZY_API_KEY;
const storeId = import.meta.env.VITE_LEMONSQUEEZY_STORE_ID;
const basicVariant = import.meta.env.VITE_LEMONSQUEEZY_BASIC_VARIANT_ID;

console.log("ğŸ” æœåŠ¡ç«¯ç¯å¢ƒå˜é‡æ£€æŸ¥:", {
  apiKey: apiKey
    ? `${apiKey.substring(0, 20)}... (${apiKey.length} å­—ç¬¦)`
    : "æœªè®¾ç½®",
  storeId: storeId || "æœªè®¾ç½®",
  basicVariant: basicVariant || "æœªè®¾ç½®",
  allEnv: import.meta.env,
});
---

<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <title>ç®€å•ç¯å¢ƒå˜é‡æµ‹è¯•</title>
    <style>
      body {
        font-family: monospace;
        padding: 20px;
        background: #1a1a1a;
        color: #fff;
      }
      .status {
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        border: 1px solid;
      }
      .success {
        background: #0f5132;
        border-color: #198754;
      }
      .error {
        background: #842029;
        border-color: #dc3545;
      }
      pre {
        background: #2a2a2a;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” ç®€å•ç¯å¢ƒå˜é‡æµ‹è¯•</h1>

    <div class={`status ${apiKey && storeId ? "success" : "error"}`}>
      <h2>æœåŠ¡ç«¯æ£€æŸ¥ç»“æœ: {apiKey && storeId ? "âœ… æ­£å¸¸" : "âŒ å¼‚å¸¸"}</h2>
      <ul>
        <li>
          API Key: {apiKey ? `âœ… å·²è®¾ç½® (${apiKey.length} å­—ç¬¦)` : "âŒ æœªè®¾ç½®"}
        </li>
        <li>Store ID: {storeId ? `âœ… ${storeId}` : "âŒ æœªè®¾ç½®"}</li>
        <li>
          Basic Variant: {basicVariant ? `âœ… ${basicVariant}` : "âŒ æœªè®¾ç½®"}
        </li>
      </ul>
    </div>

    <h3>ğŸ“‹ æœåŠ¡ç«¯ç¯å¢ƒå˜é‡ (Astro æ„å»ºæ—¶)</h3>
    <pre>{JSON.stringify({
        VITE_LEMONSQUEEZY_API_KEY: apiKey ? `${apiKey.substring(0, 30)}... (${apiKey.length} å­—ç¬¦)` : null,
        VITE_LEMONSQUEEZY_STORE_ID: storeId,
        VITE_LEMONSQUEEZY_BASIC_VARIANT_ID: basicVariant,
        VITE_LEMONSQUEEZY_PRO_VARIANT_ID: import.meta.env.VITE_LEMONSQUEEZY_PRO_VARIANT_ID,
        VITE_LEMONSQUEEZY_PREMIUM_VARIANT_ID: import.meta.env.VITE_LEMONSQUEEZY_PREMIUM_VARIANT_ID,
    }, null, 2)}</pre>

    <div id="client-result"></div>

    <script>
      console.log("ğŸ” å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡æ£€æŸ¥å¼€å§‹");

      // å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡æ£€æŸ¥
      const clientEnv = {
        VITE_LEMONSQUEEZY_API_KEY: import.meta.env.VITE_LEMONSQUEEZY_API_KEY,
        VITE_LEMONSQUEEZY_STORE_ID: import.meta.env.VITE_LEMONSQUEEZY_STORE_ID,
        VITE_LEMONSQUEEZY_BASIC_VARIANT_ID: import.meta.env
          .VITE_LEMONSQUEEZY_BASIC_VARIANT_ID,
        VITE_LEMONSQUEEZY_PRO_VARIANT_ID: import.meta.env
          .VITE_LEMONSQUEEZY_PRO_VARIANT_ID,
        VITE_LEMONSQUEEZY_PREMIUM_VARIANT_ID: import.meta.env
          .VITE_LEMONSQUEEZY_PREMIUM_VARIANT_ID,
      };

      console.log("å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡:", clientEnv);
      console.log("æ‰€æœ‰ç¯å¢ƒå˜é‡:", import.meta.env);

      const hasApiKey = !!clientEnv.VITE_LEMONSQUEEZY_API_KEY;
      const hasStoreId = !!clientEnv.VITE_LEMONSQUEEZY_STORE_ID;
      const isConfigured = hasApiKey && hasStoreId;

      // æ˜¾ç¤ºå®¢æˆ·ç«¯ç»“æœ
      const resultDiv = document.getElementById("client-result");
      resultDiv.innerHTML = `
            <div class="status ${isConfigured ? "success" : "error"}">
                <h2>å®¢æˆ·ç«¯æ£€æŸ¥ç»“æœ: ${isConfigured ? "âœ… æ­£å¸¸" : "âŒ å¼‚å¸¸"}</h2>
                <ul>
                    <li>API Key: ${hasApiKey ? `âœ… å·²è®¾ç½® (${clientEnv.VITE_LEMONSQUEEZY_API_KEY.length} å­—ç¬¦)` : "âŒ æœªè®¾ç½®"}</li>
                    <li>Store ID: ${hasStoreId ? `âœ… ${clientEnv.VITE_LEMONSQUEEZY_STORE_ID}` : "âŒ æœªè®¾ç½®"}</li>
                    <li>Basic Variant: ${clientEnv.VITE_LEMONSQUEEZY_BASIC_VARIANT_ID ? `âœ… ${clientEnv.VITE_LEMONSQUEEZY_BASIC_VARIANT_ID}` : "âŒ æœªè®¾ç½®"}</li>
                </ul>
            </div>
            
            <h3>ğŸ“‹ å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡ (æµè§ˆå™¨è¿è¡Œæ—¶)</h3>
            <pre>${JSON.stringify(clientEnv, null, 2)}</pre>
            
            <h3>ğŸŒ æ‰€æœ‰å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡</h3>
            <pre style="max-height: 300px; overflow-y: auto;">${JSON.stringify(import.meta.env, null, 2)}</pre>
        `;

      // æµ‹è¯•é…ç½®å‡½æ•°
      console.log("ğŸ§ª æµ‹è¯•é…ç½®å‡½æ•°:");

      // æ¨¡æ‹Ÿ isLemonsqueezyConfigured å‡½æ•°
      const ENV = {
        LEMONSQUEEZY_API_KEY: clientEnv.VITE_LEMONSQUEEZY_API_KEY || "",
        LEMONSQUEEZY_STORE_ID: clientEnv.VITE_LEMONSQUEEZY_STORE_ID || "",
      };

      const isLemonsqueezyConfigured = !!(
        ENV.LEMONSQUEEZY_API_KEY && ENV.LEMONSQUEEZY_STORE_ID
      );

      console.log("ENV å¯¹è±¡:", ENV);
      console.log("isLemonsqueezyConfigured():", isLemonsqueezyConfigured);

      if (!isLemonsqueezyConfigured) {
        console.error("âŒ Lemonsqueezy é…ç½®ä¸å®Œæ•´");
        if (!ENV.LEMONSQUEEZY_API_KEY) {
          console.error("  - ç¼ºå°‘ API Key");
        }
        if (!ENV.LEMONSQUEEZY_STORE_ID) {
          console.error("  - ç¼ºå°‘ Store ID");
        }
      } else {
        console.log("âœ… Lemonsqueezy é…ç½®å®Œæ•´");
      }
    </script>
  </body>
</html>
