---
// ç®€å•çš„ç¯å¢ƒå˜é‡æµ‹è¯•é¡µé¢
const envVars = {
  VITE_LEMONSQUEEZY_API_KEY: import.meta.env.VITE_LEMONSQUEEZY_API_KEY,
  VITE_LEMONSQUEEZY_STORE_ID: import.meta.env.VITE_LEMONSQUEEZY_STORE_ID,
  VITE_LEMONSQUEEZY_BASIC_VARIANT_ID: import.meta.env
    .VITE_LEMONSQUEEZY_BASIC_VARIANT_ID,
  VITE_LEMONSQUEEZY_PRO_VARIANT_ID: import.meta.env
    .VITE_LEMONSQUEEZY_PRO_VARIANT_ID,
  VITE_LEMONSQUEEZY_PREMIUM_VARIANT_ID: import.meta.env
    .VITE_LEMONSQUEEZY_PREMIUM_VARIANT_ID,
};

// æ£€æŸ¥é…ç½®çŠ¶æ€
const configStatus = {
  hasApiKey: !!envVars.VITE_LEMONSQUEEZY_API_KEY,
  hasStoreId: !!envVars.VITE_LEMONSQUEEZY_STORE_ID,
  hasBasicVariant: !!envVars.VITE_LEMONSQUEEZY_BASIC_VARIANT_ID,
  hasProVariant: !!envVars.VITE_LEMONSQUEEZY_PRO_VARIANT_ID,
  hasPremiumVariant: !!envVars.VITE_LEMONSQUEEZY_PREMIUM_VARIANT_ID,
};

const allConfigured = Object.values(configStatus).every(Boolean);
---

<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <title>ç¯å¢ƒå˜é‡æµ‹è¯•</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        line-height: 1.6;
      }
      .status {
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
      }
      .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .warning {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
      .truncate {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .code {
        background: #f4f4f4;
        padding: 0.2rem 0.4rem;
        border-radius: 4px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” ç¯å¢ƒå˜é‡æµ‹è¯•é¡µé¢</h1>

    <div class={`status ${allConfigured ? "success" : "error"}`}>
      <h2>
        {allConfigured ? "âœ… é…ç½®çŠ¶æ€ï¼šæ­£å¸¸" : "âŒ é…ç½®çŠ¶æ€ï¼šæœ‰é—®é¢˜"}
      </h2>
      <p>
        {
          allConfigured
            ? "æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡éƒ½å·²æ­£ç¡®é…ç½®ã€‚"
            : "éƒ¨åˆ†ç¯å¢ƒå˜é‡ç¼ºå¤±æˆ–æœªæ­£ç¡®é…ç½®ã€‚"
        }
      </p>
    </div>

    <h2>ğŸ“‹ ç¯å¢ƒå˜é‡è¯¦æƒ…</h2>
    <table>
      <thead>
        <tr>
          <th>å˜é‡å</th>
          <th>çŠ¶æ€</th>
          <th>å€¼ï¼ˆæˆªæ–­ï¼‰</th>
        </tr>
      </thead>
      <tbody>
        {
          Object.entries(envVars).map(([key, value]) => (
            <tr>
              <td class="code">{key}</td>
              <td>{value ? "âœ… å·²è®¾ç½®" : "âŒ æœªè®¾ç½®"}</td>
              <td class="truncate">
                {value
                  ? typeof value === "string" && value.length > 50
                    ? value.substring(0, 50) + "..."
                    : value
                  : "(ç©º)"}
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>

    <h2>ğŸ”§ é…ç½®æ£€æŸ¥</h2>
    <table>
      <thead>
        <tr>
          <th>æ£€æŸ¥é¡¹</th>
          <th>çŠ¶æ€</th>
          <th>è¯´æ˜</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>API Key</td>
          <td>{configStatus.hasApiKey ? "âœ…" : "âŒ"}</td>
          <td>
            {configStatus.hasApiKey ? "å·²é…ç½®" : "ç¼ºå°‘ API Key"}
          </td>
        </tr>
        <tr>
          <td>Store ID</td>
          <td>{configStatus.hasStoreId ? "âœ…" : "âŒ"}</td>
          <td>
            {configStatus.hasStoreId ? "å·²é…ç½®" : "ç¼ºå°‘ Store ID"}
          </td>
        </tr>
        <tr>
          <td>Basic Variant</td>
          <td>{configStatus.hasBasicVariant ? "âœ…" : "âŒ"}</td>
          <td>
            {configStatus.hasBasicVariant ? "å·²é…ç½®" : "ç¼ºå°‘åŸºç¡€å¥—é¤å˜ä½“ ID"}
          </td>
        </tr>
        <tr>
          <td>Pro Variant</td>
          <td>{configStatus.hasProVariant ? "âœ…" : "âŒ"}</td>
          <td>
            {configStatus.hasProVariant ? "å·²é…ç½®" : "ç¼ºå°‘ä¸“ä¸šå¥—é¤å˜ä½“ ID"}
          </td>
        </tr>
        <tr>
          <td>Premium Variant</td>
          <td>{configStatus.hasPremiumVariant ? "âœ…" : "âŒ"}</td>
          <td>
            {configStatus.hasPremiumVariant ? "å·²é…ç½®" : "ç¼ºå°‘é«˜çº§å¥—é¤å˜ä½“ ID"}
          </td>
        </tr>
      </tbody>
    </table>

    {
      !allConfigured && (
        <div class="status warning">
          <h3>âš ï¸ ä¿®å¤å»ºè®®</h3>
          <ol>
            <li>
              æ£€æŸ¥ <code>.env</code> æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡è®¾ç½®
            </li>
            <li>
              ç¡®ä¿æ‰€æœ‰å˜é‡éƒ½ä»¥ <code>VITE_</code> å¼€å¤´
            </li>
            <li>é‡å¯å¼€å‘æœåŠ¡å™¨ä»¥åŠ è½½æ–°çš„ç¯å¢ƒå˜é‡</li>
            <li>
              æ£€æŸ¥ <code>astro.config.mjs</code> ä¸­çš„ Vite é…ç½®
            </li>
          </ol>
        </div>
      )
    }

    <h2>ğŸ§ª æµ‹è¯•æ“ä½œ</h2>
    <div class="status">
      <p>å¦‚æœé…ç½®æ­£ç¡®ï¼Œä½ å¯ä»¥ï¼š</p>
      <ul>
        <li>
          <a href="/pricing">è®¿é—®å®šä»·é¡µé¢</a> æµ‹è¯•æ”¯ä»˜æµç¨‹
        </li>
        <li>
          <a href="/analyze">è®¿é—®åˆ†æé¡µé¢</a> æµ‹è¯•åŠŸèƒ½
        </li>
        <li>åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ JavaScript æµ‹è¯•</li>
      </ul>
    </div>

    <script>
      // å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡æµ‹è¯•
      console.log("ğŸ” å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡æµ‹è¯•:");
      console.log(
        "VITE_LEMONSQUEEZY_API_KEY:",
        import.meta.env.VITE_LEMONSQUEEZY_API_KEY ? "å·²è®¾ç½®" : "æœªè®¾ç½®",
      );
      console.log(
        "VITE_LEMONSQUEEZY_STORE_ID:",
        import.meta.env.VITE_LEMONSQUEEZY_STORE_ID,
      );
      console.log("æ‰€æœ‰ç¯å¢ƒå˜é‡:", import.meta.env);

      // æµ‹è¯•é…ç½®åŠ è½½
      window.testLemonsqueezyConfig = function () {
        console.log("ğŸ§ª æµ‹è¯• Lemonsqueezy é…ç½®:");

        const config = {
          apiKey: import.meta.env.VITE_LEMONSQUEEZY_API_KEY,
          storeId: import.meta.env.VITE_LEMONSQUEEZY_STORE_ID,
          basicVariant: import.meta.env.VITE_LEMONSQUEEZY_BASIC_VARIANT_ID,
          proVariant: import.meta.env.VITE_LEMONSQUEEZY_PRO_VARIANT_ID,
          premiumVariant: import.meta.env.VITE_LEMONSQUEEZY_PREMIUM_VARIANT_ID,
        };

        console.table(config);

        const isConfigured = Object.values(config).every((value) => !!value);
        console.log(isConfigured ? "âœ… é…ç½®å®Œæ•´" : "âŒ é…ç½®ä¸å®Œæ•´");

        return config;
      };

      console.log("ğŸ’¡ è¿è¡Œ testLemonsqueezyConfig() æ¥æµ‹è¯•é…ç½®");
    </script>
  </body>
</html>
