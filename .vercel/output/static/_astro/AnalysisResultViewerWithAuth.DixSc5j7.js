import{j as e,A as C,C as S}from"./CreditContext.Cd34fGmH.js";import{r as n}from"./index.D5cfIYOg.js";import{H as E,A as b,a as j,D as k}from"./HistorySidebar.SQ62BMcG.js";import"./UserAccountDropdown.Byx-syBn.js";import"./useSubscription.Cs8u4hSB.js";import"./LoginModal.D24Kv1o2.js";function L({analysisId:l}){const[r,m]=n.useState(null),[N,o]=n.useState(!0),[h,u]=n.useState(""),[p,d]=n.useState(!1),y=n.useCallback(async()=>{try{o(!0),u("");const t=sessionStorage.getItem("heroAnalysisResult");if(t){const a=JSON.parse(t);if(a.id,a.audioUrl,a.audioUrl?.substring(0,100)+"",a.id===l){m(a),window.currentAnalysisResult=a,window.backupAnalysisResult=a;const c=new CustomEvent("analysisResultReady",{detail:a});window.dispatchEvent(c),o(!1);return}}const s=E.getRecordById(l);if(s){s.id,s.audioUrl,s.audioUrl?.substring(0,100)+"";const a={id:s.id,filename:s.filename,timestamp:s.timestamp,duration:s.duration,fileSize:s.fileSize,format:s.format,audioUrl:s.audioUrl,contentType:s.contentType||{primary:"music",confidence:.8,description:"Music content (legacy record)"},basicInfo:s.basicInfo,voiceAnalysis:s.voiceAnalysis||{hasVoice:!1,speakerCount:0,genderDetection:{primary:"unknown",confidence:0,multipleGenders:!1},speakerEmotion:{primary:"neutral",confidence:0,emotions:{happy:0,sad:0,angry:0,calm:0,excited:0,nervous:0,confident:0,stressed:0}},speechClarity:{score:0,pronunciation:0,articulation:0,pace:"normal",volume:"normal"},vocalCharacteristics:{pitchRange:"medium",speakingRate:0,pauseFrequency:"low",intonationVariation:0},languageAnalysis:{language:"unknown",confidence:0,accent:"unknown"},audioQuality:{backgroundNoise:0,echo:0,compression:0,overall:0}},soundEffects:s.soundEffects||{detected:[],environment:{location_type:"indoor",setting:"commercial",activity_level:"moderate",acoustic_space:"medium",time_of_day:"unknown",weather:"unknown"}},emotions:s.emotions||{happy:.78,sad:.12,angry:.05,calm:.25,excited:.82},structure:s.structure||{intro:{start:0,end:8},verse1:{start:8,end:32},chorus1:{start:32,end:56},verse2:{start:56,end:80},chorus2:{start:80,end:104},bridge:{start:104,end:128},outro:{start:128,end:180}},quality:s.quality||{overall:s.quickStats.qualityScore,clarity:9.2,loudness:-8.5,dynamic_range:7.8,noise_level:2.1},similarity:s.similarity||{similar_tracks:[{title:"Midnight Drive",artist:"Synthwave Artist",similarity:.87},{title:"Neon Lights",artist:"Retro Collective",similarity:.82},{title:"Digital Dreams",artist:"Electronic Vibes",similarity:.79}]},tags:s.tags||R(s.basicInfo,s.emotions||{happy:.78,sad:.12,angry:.05,calm:.25,excited:.82},{overall:s.quickStats.qualityScore},s.filename),aiDescription:s.aiDescription||`A ${s.basicInfo.mood.toLowerCase()} ${s.basicInfo.genre.toLowerCase()} track with professional quality.`,processingTime:s.processingTime||0};m(a),window.currentAnalysisResult=a,window.backupAnalysisResult=a;const c=new CustomEvent("analysisResultReady",{detail:a});window.dispatchEvent(c),o(!1);return}u("Analysis result not found. It may have been deleted or the link is invalid."),o(!1)}catch(t){console.error("Error loading analysis result:",t),u("Failed to load analysis result. Please try again."),o(!1)}},[l]),R=(t,s,a,c)=>{const i=[];i.push(t.genre.toLowerCase()),i.push(t.mood.toLowerCase()),t.energy>.8?i.push("high-energy","energetic","intense"):t.energy>.6?i.push("medium-energy","upbeat"):i.push("low-energy","calm","relaxed"),t.bpm>140?i.push("fast-tempo","dance","workout"):t.bpm>100?i.push("moderate-tempo","groove"):i.push("slow-tempo","chill","ambient");const A=Object.entries(s).reduce((w,v)=>s[w[0]]>s[v[0]]?w:v)[0];i.push(A),s.happy>.6&&i.push("uplifting","positive"),s.sad>.6&&i.push("melancholic","emotional"),s.excited>.7&&i.push("exciting","dynamic"),s.calm>.6&&i.push("peaceful","serene"),a.overall>8?i.push("high-quality","professional","studio-quality"):a.overall>6&&i.push("good-quality"),a.clarity>8&&i.push("clear","crisp"),a.dynamic_range>7&&i.push("dynamic"),t.danceability>.8&&i.push("danceable","groovy","rhythmic"),t.valence>.7?i.push("positive","bright"):t.valence<.4&&i.push("dark","moody");const g=c.split(".").pop()?.toLowerCase();return g&&i.push(`${g}-file`),i.push("ai-analyzed","music-analysis","audio-processing"),[...new Set(i)].slice(0,15)},x=n.useCallback(t=>{window.location.href=`/analysis/${t.id}`},[]),f=n.useCallback(()=>{window.location.href="/analyze"},[]);return n.useEffect(()=>(y(),()=>{window.currentAnalysisResult=null,window.backupAnalysisResult=null;const t=new CustomEvent("analysisResultCleared");window.dispatchEvent(t)}),[y]),N?e.jsx("div",{className:"min-h-screen bg-dark-bg flex items-center justify-center",children:e.jsx("div",{className:"glass-pane p-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-violet-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-white",children:"Loading analysis result..."})]})})}):h?e.jsxs("div",{className:"min-h-screen bg-dark-bg",children:[e.jsx(b,{}),e.jsx("div",{className:"pt-16",children:e.jsx("div",{className:"max-w-6xl mx-auto px-6 py-8",children:e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"glass-pane p-8 max-w-md mx-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Analysis Not Found"}),e.jsx("p",{className:"text-slate-400 mb-6",children:h}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>window.location.href="/analyze",className:"btn btn-primary",children:"Start New Analysis"}),e.jsx("button",{onClick:()=>window.location.href="/",className:"btn btn-secondary",children:"Go Home"})]})]})})})})]}):r?e.jsxs("div",{className:"min-h-screen bg-dark-bg",children:[e.jsx(b,{}),e.jsx("div",{className:"md:hidden pt-16 pb-4 px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Analysis Result"}),e.jsxs("button",{onClick:()=>d(!p),className:"inline-flex items-center justify-center gap-2 px-4 py-2 bg-white/5 text-slate-300 border border-white/10 rounded-full hover:bg-white/10 transition-all duration-300",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"History"]})]})}),e.jsx("div",{className:"hidden md:block pt-16"}),e.jsxs("div",{className:"relative",children:[p&&e.jsxs("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40 md:hidden",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-80 max-w-[90vw]",children:e.jsx(j,{selectedRecordId:r?.id,onSelectRecord:t=>{x(t),d(!1)},onNewAnalysis:()=>{f(),d(!1)}})}),e.jsx("button",{onClick:()=>d(!1),className:"absolute top-4 right-4 p-2 text-white bg-black/50 rounded-full",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"hidden md:flex h-[calc(100vh-64px)] min-h-[600px]",children:[e.jsx(j,{selectedRecordId:r?.id,onSelectRecord:x,onNewAnalysis:f}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"max-w-6xl mx-auto px-6 py-8",children:e.jsx(k,{result:r})})})]}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"max-w-6xl mx-auto px-6 py-8",children:e.jsx(k,{result:r})})})]})]}):null}function q({analysisId:l}){return e.jsx(C,{children:e.jsx(S,{children:e.jsx(L,{analysisId:l})})})}export{q as default};
