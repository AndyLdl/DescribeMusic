[debug] [2025-09-21T02:22:29.286Z] ----------------------------------------------------------------------
[debug] [2025-09-21T02:22:29.287Z] Command:       /Users/andy/.nvm/versions/node/v20.19.0/bin/node /Users/andy/.nvm/versions/node/v20.19.0/bin/firebase functions:log --only analyzeAudioFromUrl --project describe-music
[debug] [2025-09-21T02:22:29.288Z] CLI Version:   14.12.0
[debug] [2025-09-21T02:22:29.288Z] Platform:      darwin
[debug] [2025-09-21T02:22:29.288Z] Node Version:  v20.19.0
[debug] [2025-09-21T02:22:29.288Z] Time:          Sun Sep 21 2025 10:22:29 GMT+0800 (China Standard Time)
[debug] [2025-09-21T02:22:29.288Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-09-21T02:22:29.291Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-09-21T02:22:29.291Z] > authorizing via signed-in user (ldliangcool@gmail.com)
[debug] [2025-09-21T02:22:29.291Z] [iam] checking project describe-music for permissions ["firebase.projects.get","logging.logEntries.list","logging.logs.list"]
[debug] [2025-09-21T02:22:29.291Z] Checked if tokens are valid: true, expires at: 1758423969662
[debug] [2025-09-21T02:22:29.291Z] Checked if tokens are valid: true, expires at: 1758423969662
[debug] [2025-09-21T02:22:29.292Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/describe-music:testIamPermissions [none]
[debug] [2025-09-21T02:22:29.292Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/describe-music:testIamPermissions x-goog-quota-user=projects/describe-music
[debug] [2025-09-21T02:22:29.292Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/describe-music:testIamPermissions {"permissions":["firebase.projects.get","logging.logEntries.list","logging.logs.list"]}
[debug] [2025-09-21T02:22:30.442Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/describe-music:testIamPermissions 200
[debug] [2025-09-21T02:22:30.442Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/describe-music:testIamPermissions {"permissions":["firebase.projects.get","logging.logEntries.list","logging.logs.list"]}
[debug] [2025-09-21T02:22:30.443Z] Checked if tokens are valid: true, expires at: 1758423969662
[debug] [2025-09-21T02:22:30.443Z] Checked if tokens are valid: true, expires at: 1758423969662
[debug] [2025-09-21T02:22:30.443Z] >>> [apiv2][query] POST https://logging.googleapis.com/v2/entries:list [none]
[debug] [2025-09-21T02:22:30.443Z] >>> [apiv2][body] POST https://logging.googleapis.com/v2/entries:list {"resourceNames":["projects/describe-music"],"filter":"resource.type=\"cloud_function\" OR (resource.type=\"cloud_run_revision\" AND labels.\"goog-managed-by\"=\"cloudfunctions\")\n(resource.labels.function_name=\"analyzeAudioFromUrl\" OR resource.labels.service_name=\"analyzeAudioFromUrl\")","orderBy":"timestamp desc","pageSize":35}
[debug] [2025-09-21T02:22:33.694Z] <<< [apiv2][status] POST https://logging.googleapis.com/v2/entries:list 200
[debug] [2025-09-21T02:22:33.694Z] <<< [apiv2][body] POST https://logging.googleapis.com/v2/entries:list {"entries":[{"textPayload":"Function execution took 12302 ms, finished with status code: 500","insertId":"154osfhf20vwac","resource":{"type":"cloud_function","labels":{"region":"us-central1","function_name":"analyzeAudioFromUrl","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:52.457488226Z","severity":"DEBUG","labels":{"execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:52.705295984Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"447","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"[2025-09-21T02:21:52.453Z] INFO Credits refunded for failed analysis { userId: '9abd3b50-ff36-4e44-b6a6-9036fbf7887b', creditsRefunded: 2 }","insertId":"68cf61400006eb405d484253","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","region":"us-central1","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:52.453440Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:52.705295984Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"706","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"}","insertId":"68cf61400006e978d22310f2","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:52.452984Z","labels":{"execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:52.705295984Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"567","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  reason: 'Analysis failed: Vertex AI request failed: response.text is not a function'","insertId":"68cf61400006e974e41be4de","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","project_id":"describe-music","region":"us-central1"}},"timestamp":"2025-09-21T02:21:52.452980Z","labels":{"execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:52.705295984Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"652","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  creditsAmount: 2,","insertId":"68cf61400006e96f88d78542","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","region":"us-central1","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:52.452975Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:52.705295984Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"585","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  userId: '9abd3b50-ff36-4e44-b6a6-9036fbf7887b',","insertId":"68cf61400006e96bcd8e7d11","resource":{"type":"cloud_function","labels":{"region":"us-central1","function_name":"analyzeAudioFromUrl","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:52.452971Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:52.705295984Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"615","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"[2025-09-21T02:21:52.452Z] INFO User credits refunded successfully {","insertId":"68cf61400006e95dd5bf4d28","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","function_name":"analyzeAudioFromUrl","region":"us-central1"}},"timestamp":"2025-09-21T02:21:52.452957Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:52.705295984Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"634","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"}","insertId":"68cf613f000a391d45e5d7d9","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669981Z","labels":{"runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"567","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  }","insertId":"68cf613f000a39198e1ed150","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","function_name":"analyzeAudioFromUrl","region":"us-central1"}},"timestamp":"2025-09-21T02:21:51.669977Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"569","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    requestId: 'd11fe797-1da5-4f12-8f38-19de9a5d900c'","insertId":"68cf613f000a391550ee3170","resource":{"type":"cloud_function","labels":{"region":"us-central1","function_name":"analyzeAudioFromUrl","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:51.669973Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"619","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    duration: 5929,","insertId":"68cf613f000a391254cde873","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669970Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"585","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    originalError: 'response.text is not a function',","insertId":"68cf613f000a390e715d5870","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","function_name":"analyzeAudioFromUrl","region":"us-central1"}},"timestamp":"2025-09-21T02:21:51.669966Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"619","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  details: {","insertId":"68cf613f000a3908cb5b5b69","resource":{"type":"cloud_function","labels":{"region":"us-central1","project_id":"describe-music","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669960Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"578","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  statusCode: 502,","insertId":"68cf613f000a3904dc6e9dde","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669956Z","labels":{"runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"584","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  code: 'GEMINI_API_ERROR',","insertId":"68cf613f000a3900f6e156c5","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669952Z","labels":{"runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"593","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    at async /workspace/lib/index.js:313:32 {","insertId":"68cf613f000a38fce2d35928","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669948Z","labels":{"execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"611","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","insertId":"68cf613f000a38f8fe82ca82","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","function_name":"analyzeAudioFromUrl","region":"us-central1"}},"timestamp":"2025-09-21T02:21:51.669944Z","labels":{"execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"647","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    at VertexAIService.analyzeAudio (/workspace/lib/services/vertexAIService.js:135:19)","insertId":"68cf613f000a38f47e754f80","resource":{"type":"cloud_function","labels":{"region":"us-central1","function_name":"analyzeAudioFromUrl","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:51.669940Z","labels":{"execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"653","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    at new GeminiError (/workspace/lib/utils/errors.js:44:9)","insertId":"68cf613f000a38eff727f694","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669935Z","labels":{"execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"626","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"Analysis error: GeminiError: Vertex AI request failed: response.text is not a function","insertId":"68cf613f000a38e2ac64233f","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669922Z","labels":{"runtime_version":"nodejs18_20250831_18_20_8_RC00","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"652","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    at async /workspace/lib/index.js:313:32","insertId":"68cf613f000a375fbd88b41b","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669535Z","labels":{"execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"609","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    at async VertexAIService.analyzeAudio (/workspace/lib/services/vertexAIService.js:105:42)","insertId":"68cf613f000a375c05e4f12d","resource":{"type":"cloud_function","labels":{"region":"us-central1","project_id":"describe-music","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669532Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"659","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","insertId":"68cf613f000a3759a3d2ca45","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","region":"us-central1","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:51.669529Z","labels":{"execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"647","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"    at VertexAIService.callVertexAIWithRetry (/workspace/lib/services/vertexAIService.js:190:39)","insertId":"68cf613f000a37553721907f","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","region":"us-central1","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.669525Z","labels":{"runtime_version":"nodejs18_20250831_18_20_8_RC00","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"662","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"Error details: TypeError: response.text is not a function","insertId":"68cf613f000a374a0486def9","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","function_name":"analyzeAudioFromUrl","region":"us-central1"}},"timestamp":"2025-09-21T02:21:51.669514Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"623","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"}","insertId":"68cf613f000a34e1e4a2881e","resource":{"type":"cloud_function","labels":{"region":"us-central1","function_name":"analyzeAudioFromUrl","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:51.668897Z","labels":{"runtime_version":"nodejs18_20250831_18_20_8_RC00","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"567","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  promptLength: 4809","insertId":"68cf613f000a34de359efc12","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","region":"us-central1","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:51.668894Z","labels":{"execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"586","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  requestId: 'd11fe797-1da5-4f12-8f38-19de9a5d900c',","insertId":"68cf613f000a34daa275c6f3","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","project_id":"describe-music","region":"us-central1"}},"timestamp":"2025-09-21T02:21:51.668890Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"618","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"[2025-09-21T02:21:51.669Z] ERROR Vertex AI error after 5929ms {","insertId":"68cf613f000a34ce5c838d89","resource":{"type":"cloud_function","labels":{"region":"us-central1","project_id":"describe-music","function_name":"analyzeAudioFromUrl"}},"timestamp":"2025-09-21T02:21:51.668878Z","labels":{"execution_id":"0vvq9i3q2k7j","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:51.707184716Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"629","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"[2025-09-21T02:21:45.741Z] DEBUG [d11fe797-1da5-4f12-8f38-19de9a5d900c] Gemini API request { promptLength: 103 }","insertId":"68cf6139000b4e796cf0a9a4","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","function_name":"analyzeAudioFromUrl","region":"us-central1"}},"timestamp":"2025-09-21T02:21:45.740985Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:46.045065706Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"677","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"[2025-09-21T02:21:45.738Z] INFO Audio file downloaded for analysis { size: '31533', requestId: 'download_1758421303436' }","insertId":"68cf6139000b454543c92bd7","resource":{"type":"cloud_function","labels":{"region":"us-central1","function_name":"analyzeAudioFromUrl","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:45.738629Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","runtime_version":"nodejs18_20250831_18_20_8_RC00","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:46.045065706Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"686","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"}","insertId":"68cf61370006a7420de75cbf","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","region":"us-central1","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:43.436034Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:43.713712237Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"567","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  requestId: 'download_1758421303436'","insertId":"68cf61370006a73ed7bdefd1","resource":{"type":"cloud_function","labels":{"project_id":"describe-music","function_name":"analyzeAudioFromUrl","region":"us-central1"}},"timestamp":"2025-09-21T02:21:43.436030Z","labels":{"execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:43.713712237Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"603","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  fileName: 'ttsvibes-jessie-f.mp3',","insertId":"68cf61370006a73a380f23d1","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","project_id":"describe-music","region":"us-central1"}},"timestamp":"2025-09-21T02:21:43.436026Z","labels":{"runtime_version":"nodejs18_20250831_18_20_8_RC00","instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:43.713712237Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"602","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}},{"textPayload":"  fileUrl: 'https://storage.googleapis.com/describe-music/audio/1758421297639_8albd97gtoe.mp3?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=describe-music%40appspot.gserviceaccount.com%2F20250921%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20250921T022137Z&X-Goog-Expires=86400&X-Goog-SignedHeaders=host&X-Goog-Signature=682836600a3fcd211ab0af3c1de7804bf48e1c1b4b4e289caa7e5ea9b9738d5762960c260673d5b0acd3313ac48f018bb9f01d370d414235bf237701f9d2c6bb01b2f0de4252642da06ff1f27426bdec8089512805271fa40836ad438602608b843174997e7afa97a68032f933b02cebb092fc99868ec373a5c1ee634dd61bbe4b3d61c61bf54970b577f9cc7f0a9c4c2858381d22660c296e5dc76747c9f87adfca85acd7fe73fd2709b22a43ac662afd1d106272626c82f58e16664ce05a2f5a519ab5d165e0542ee03144000c3a0939c07afdf6986da6ceb87a27d4c45167079ba41b1db14614e98b3c081489456377b6cec488b24fb5d0fc9d1e94968284',","insertId":"68cf61370006a735c595c6e9","resource":{"type":"cloud_function","labels":{"function_name":"analyzeAudioFromUrl","region":"us-central1","project_id":"describe-music"}},"timestamp":"2025-09-21T02:21:43.436021Z","labels":{"instance_id":"0069c7a988283751690e1ca01ace4bf82ff95c5e3a9163e07c6c31625fad55f62f49d7268179a92e9b3a313a499bdaa6ec7fe20538e891d3f603d605fc074cacb8747bab1b40be040c4335d1a99d","execution_id":"0vvq9i3q2k7j","runtime_version":"nodejs18_20250831_18_20_8_RC00"},"logName":"projects/describe-music/logs/cloudfunctions.googleapis.com%2Fcloud-functions","writerEmailAddress":"app-engine-appserver@prod.google.com","internalId":{"projectNumber":"741222075328"},"trace":"projects/describe-music/traces/f6084fa68cc1428002ce6e1ffa3fb2cf","receiveTimestamp":"2025-09-21T02:21:43.713712237Z","internalMetadata":{"queryAnnotations":{"residentBucketUuid":"741222075328_d","residentBucketEntityId":{"projectNumber":"741222075328"}},"bucketUuid":[{"tcubeShardNames":["global07-us-east4"],"uid":"741222075328_d"}],"billingSize":"1409","logBucketWithSinkInfo":[{"uid":"741222075328_d","tcubeShardNames":["global07-us-east4"],"sinkInfo":[{"status":"OK","unmodifiedDefaultSinkInternalId":{"projectNumber":"741222075328"}}],"bucketOwner":{"projectNumber":"741222075328"}}]}}],"nextPageToken":"euwGCucGAecVo57EdICkh3D73qKRut6wL_CmaDjzrqHYOT8TIskE5DNSuJ9MHzr9OKXKNauWOdomXLEKD1gT28iYr1xSVK3ktPk0Nh9FINYCA0yhVQghU6sD80GxDvuGsvddTE90WJeHzXZCjEG5CCUFNvgRCa_mcodLdrpAVLTC1mlMxBtWsqLvDBiY_2HAoy9UyHbQSWMvcng0irpQcN38ppAShAzooC_zeHIPQTCwqNN-UCw9SvAgHr0sOtml6rTaMVN6mQ-uZaQC18mFWgpfF0TBMhXcwA98BiEUNvzHVPgF7Xqxf5ZHgXCctDa-jeV0grsVW8sPcMDL77wHDiAM-pWMpeMVyT4UaHfIe18b9cS5d0a8npnNd7Gyo3tCUNUiaEJ6_K93ziP8oqhg26PUn2up-2PVunjq1JhJSeNv5nY2ypXe6S4dgATwABmCL7rRVgDCjQyukYxjWIZtyeq6nsLKg63yS7Kd8cy59G5g229E4fnNRHuFO3p7pliOk-Jd23CmJmVzLvEP7h309rmnKU48J1-KS4U0zPiVxBl9MStJSPNR-sdV0PKLOLyn2H7rTkDEUV2ktv_CyCo1xQ5ZQrysgwJJAYF43eDqTGyN2erBuX9TABOBRdqE8dVVcorB3vXpEck1n_U2lfUJ9ccIgY9Qk1ptMDbBdwhO6XXi3NTY3VAT99w0S72s4ftuuFU8PHAGF1hXnwLC5Muou86942ogAkCwANW7QHw27ax5WVGvdCeXKGVHHAu9mdQnpxx-VagPBwfVhYhmLZTX_cIWgbyhIjdaF5PKgZ8Vds82dvf-Yx5IjtVfuZvGkFIN8QYwAwLP1mz26Nz_azvqZTgERaN5OKs-9c2lS_U2CSDXwW4R_OsXexC70VijM_sQhIqo83cx20JQXSpDmbKISzZ3LmeyPrKyvCqxqAqFP7oVjX9yHrRw2C3Emzi4dt6It73_jSCCg3Iu0Tc-omSojuVOqf4TtyeQAgjcxec2dJkC1tQ_0fnGfKBIifIy3fzA09caWFbmosyuKNC07ugOcKlFOEc06ZIlFdxtFUdjAHqJdXCSs9DczKcheUY3fUs_Wt8X2Rr2y986gQr23WD21iGAYeMW7cWnaEt-Mu13qhWCIVsigJw1ZkuDtgvYiMcaan7ECR1yfmXWZBPmDhAB","firstProgressLatency":"0.193553696s"}
[info] 2025-09-21T02:21:43.436021Z ? analyzeAudioFromUrl:   fileUrl: 'https://storage.googleapis.com/describe-music/audio/1758421297639_8albd97gtoe.mp3?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=describe-music%40appspot.gserviceaccount.com%2F20250921%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20250921T022137Z&X-Goog-Expires=86400&X-Goog-SignedHeaders=host&X-Goog-Signature=682836600a3fcd211ab0af3c1de7804bf48e1c1b4b4e289caa7e5ea9b9738d5762960c260673d5b0acd3313ac48f018bb9f01d370d414235bf237701f9d2c6bb01b2f0de4252642da06ff1f27426bdec8089512805271fa40836ad438602608b843174997e7afa97a68032f933b02cebb092fc99868ec373a5c1ee634dd61bbe4b3d61c61bf54970b577f9cc7f0a9c4c2858381d22660c296e5dc76747c9f87adfca85acd7fe73fd2709b22a43ac662afd1d106272626c82f58e16664ce05a2f5a519ab5d165e0542ee03144000c3a0939c07afdf6986da6ceb87a27d4c45167079ba41b1db14614e98b3c081489456377b6cec488b24fb5d0fc9d1e94968284',
[info] 2025-09-21T02:21:43.436026Z ? analyzeAudioFromUrl:   fileName: 'ttsvibes-jessie-f.mp3',
[info] 2025-09-21T02:21:43.436030Z ? analyzeAudioFromUrl:   requestId: 'download_1758421303436'
[info] 2025-09-21T02:21:43.436034Z ? analyzeAudioFromUrl: }
[info] 2025-09-21T02:21:45.738629Z ? analyzeAudioFromUrl: [2025-09-21T02:21:45.738Z] INFO Audio file downloaded for analysis { size: '31533', requestId: 'download_1758421303436' }
[info] 2025-09-21T02:21:45.740985Z ? analyzeAudioFromUrl: [2025-09-21T02:21:45.741Z] DEBUG [d11fe797-1da5-4f12-8f38-19de9a5d900c] Gemini API request { promptLength: 103 }
[info] 2025-09-21T02:21:51.668878Z ? analyzeAudioFromUrl: [2025-09-21T02:21:51.669Z] ERROR Vertex AI error after 5929ms {
[info] 2025-09-21T02:21:51.668890Z ? analyzeAudioFromUrl:   requestId: 'd11fe797-1da5-4f12-8f38-19de9a5d900c',
[info] 2025-09-21T02:21:51.668894Z ? analyzeAudioFromUrl:   promptLength: 4809
[info] 2025-09-21T02:21:51.668897Z ? analyzeAudioFromUrl: }
[info] 2025-09-21T02:21:51.669514Z ? analyzeAudioFromUrl: Error details: TypeError: response.text is not a function
[info] 2025-09-21T02:21:51.669525Z ? analyzeAudioFromUrl:     at VertexAIService.callVertexAIWithRetry (/workspace/lib/services/vertexAIService.js:190:39)
[info] 2025-09-21T02:21:51.669529Z ? analyzeAudioFromUrl:     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
[info] 2025-09-21T02:21:51.669532Z ? analyzeAudioFromUrl:     at async VertexAIService.analyzeAudio (/workspace/lib/services/vertexAIService.js:105:42)
[info] 2025-09-21T02:21:51.669535Z ? analyzeAudioFromUrl:     at async /workspace/lib/index.js:313:32
[info] 2025-09-21T02:21:51.669922Z ? analyzeAudioFromUrl: Analysis error: GeminiError: Vertex AI request failed: response.text is not a function
[info] 2025-09-21T02:21:51.669935Z ? analyzeAudioFromUrl:     at new GeminiError (/workspace/lib/utils/errors.js:44:9)
[info] 2025-09-21T02:21:51.669940Z ? analyzeAudioFromUrl:     at VertexAIService.analyzeAudio (/workspace/lib/services/vertexAIService.js:135:19)
[info] 2025-09-21T02:21:51.669944Z ? analyzeAudioFromUrl:     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
[info] 2025-09-21T02:21:51.669948Z ? analyzeAudioFromUrl:     at async /workspace/lib/index.js:313:32 {
[info] 2025-09-21T02:21:51.669952Z ? analyzeAudioFromUrl:   code: 'GEMINI_API_ERROR',
[info] 2025-09-21T02:21:51.669956Z ? analyzeAudioFromUrl:   statusCode: 502,
[info] 2025-09-21T02:21:51.669960Z ? analyzeAudioFromUrl:   details: {
[info] 2025-09-21T02:21:51.669966Z ? analyzeAudioFromUrl:     originalError: 'response.text is not a function',
[info] 2025-09-21T02:21:51.669970Z ? analyzeAudioFromUrl:     duration: 5929,
[info] 2025-09-21T02:21:51.669973Z ? analyzeAudioFromUrl:     requestId: 'd11fe797-1da5-4f12-8f38-19de9a5d900c'
[info] 2025-09-21T02:21:51.669977Z ? analyzeAudioFromUrl:   }
[info] 2025-09-21T02:21:51.669981Z ? analyzeAudioFromUrl: }
[info] 2025-09-21T02:21:52.452957Z ? analyzeAudioFromUrl: [2025-09-21T02:21:52.452Z] INFO User credits refunded successfully {
[info] 2025-09-21T02:21:52.452971Z ? analyzeAudioFromUrl:   userId: '9abd3b50-ff36-4e44-b6a6-9036fbf7887b',
[info] 2025-09-21T02:21:52.452975Z ? analyzeAudioFromUrl:   creditsAmount: 2,
[info] 2025-09-21T02:21:52.452980Z ? analyzeAudioFromUrl:   reason: 'Analysis failed: Vertex AI request failed: response.text is not a function'
[info] 2025-09-21T02:21:52.452984Z ? analyzeAudioFromUrl: }
[info] 2025-09-21T02:21:52.453440Z ? analyzeAudioFromUrl: [2025-09-21T02:21:52.453Z] INFO Credits refunded for failed analysis { userId: '9abd3b50-ff36-4e44-b6a6-9036fbf7887b', creditsRefunded: 2 }
[info] 2025-09-21T02:21:52.457488226Z D analyzeAudioFromUrl: Function execution took 12302 ms, finished with status code: 500
[debug] [2025-09-21T02:22:43.706Z] Error: Timed out.
    at Timeout._onTimeout (/Users/andy/.nvm/versions/node/v20.19.0/lib/node_modules/firebase-tools/lib/utils.js:272:49)
    at listOnTimeout (node:internal/timers:581:17)
    at process.processTimers (node:internal/timers:519:7)
[error] 
[error] Error: An unexpected error has occurred.
